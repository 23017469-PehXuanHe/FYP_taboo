<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Taboo Game - <p id="Role">Card Holder</p></title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
 
    #chatLog {
      height: 200px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      padding: 10px;
      background: #fff;
      margin-bottom: 10px;
    }
 
    #wordCard {
      border: 2px solid #0077cc;
      padding: 10px;
      background: #e0f7ff;
      margin-bottom: 10px;
    }
 
    .button-group button {
      padding: 10px 20px;
      margin-right: 10px;
      font-weight: bold;
    }
 
    #forbiddenList {
      color: red;
      margin-left: 15px;
    }
 
    #chatInput {
      width: 80%;
      padding: 5px;
    }
 
    #sendBtn {
      padding: 5px 15px;
    }
  </style>
</head>
<body>
  <h1>Taboo Game: You are a <p1 id="roleDisplay"></p1></h1>
 
  <h1>You are in <p1 id="Team"></p1></h1> <h2>Time Left:<span id="TimerDisplay">60</span></h2>
  <h2>Round:<span id="RoundDisplay">1</span> | Playing Team: <span id="PlayingTeamDisplay">Team_A</span><h2>
  <h2>Scores: <span >Team A:<span id="scoreTeamA">0</span></span> | <span>Team B:<span id="scoreTeamB">0</span></span></h2>
 
  <div id="wordCard">
    <h2>Keyword: <span id="keyword">---</span></h2>
    <h3>Forbidden Words:</h3>
    <ul id="forbiddenList">
      <li>---</li>
    </ul>
  </div>
 
  <div class="button-group">
    <button id="drawBtn" onclick="drawCard()">ðŸŽ´ Draw Card</button>
    <button onclick="buzz()">ðŸš¨ Buzzer</button>
 
  </div>
 
  <h3>Chat</h3>
  <div id="chatLog"></div>
  <input type="text" id="chatInput" placeholder="Type a message..." />
  <button id="sendBtn" onclick="sendMessage()">Send</button>
  <button id="micBtn">MIC BUTTON PLACEHOLDER</button>
 
  <script src="/socket.io/socket.io.js">
    const socket = io();
  </script>
 
 
  <script>
    socket = io();
 
    var My_Role;
    var My_Team;
 
    var currentTurn;
 
  let scores = {
    Team_A_Points: 0,
    Team_B_Points: 0
  };

    document.getElementById("drawBtn").disabled = true


 
    function drawCard() {
      socket.emit("draw_card")
      console.log("line 81")
    };
 
    function buzz() {
      alert("ðŸš¨ Buzzer Pressed! The guesser said a forbidden word!");
    };
 
   
    function sendMessage() {
      const input = document.getElementById("chatInput");
      const msg = input.value.trim();
      if (msg === "") return;
      const log = document.getElementById("chatLog");
      const newMsg = document.createElement("div");
      newMsg.textContent = "ðŸ‘¤ " + msg;
      log.appendChild(newMsg);
      log.scrollTop = log.scrollHeight;
      input.value = "";
 
      //client side message to server
      socket.emit("chat_message", msg);
      chatInput.value = "";
      console.log("Chat has been emitted from client end")
    };
 
 
    socket.on("Timer",(secondsLeft) =>{
      document.getElementById("TimerDisplay").textContent = secondsLeft;
    });
 
    socket.on("Round_End", () =>{
      alert("Round Ended")
      document.getElementById("drawBtn").disabled = true;
    })
   
    socket.on("card_drawn", (card) =>{
      if (My_Role == "card_holder") {
        console.log("Sucess")
        document.getElementById("keyword").textContent = card.keyword;
        const list = document.getElementById("forbiddenList");
        list.innerHTML ="";
        card.forbidden.forEach(word => {
          const li = document.createElement("li")
          li.textContent = word;
          list.appendChild(li)
        });
      } else if (My_Role== "guesser") {
          console.log("This line was triggered")
          const list = document.getElementById("forbiddenList");
          list.innerHTML ="";
          card.forbidden.forEach(word => {
            const li = document.createElement("li")
            li.textContent = word;
            list.appendChild(li)
          });
      };
    document.getElementById("drawBtn").disabled = true;

    });
 
    socket.on("role_assigned", (role) => {
      const drawBtn = document.getElementById("drawBtn")
      const roleDisplay = document.getElementById("roleDisplay")
      My_Role=role

      if (role == "guesser") {
        roleDisplay.textContent = "Guesser"
        drawBtn.style.display = "none";
       
      };
 
      if (role == "card_holder") {
        roleDisplay.textContent = "card_holder"
       
      };
 
    });
 
    socket.on("Team", (assignedTeam) => {
      const Team = document.getElementById("Team")
      My_Team = assignedTeam
      if (assignedTeam == "Team_A") {
        Team.textContent = "Team_A"
      }
 
      if (assignedTeam == "Team_B") {
        Team.textContent = "Team_B"
      }
    })
 
    //Client side WS code to display sent messages
    socket.on("chat_message" , (Reply) => {
      const log = document.getElementById("chatLog");
      const newMsg = document.createElement("div");
      newMsg.textContent = `Other: ${Reply}`
      log.appendChild(newMsg);
      log.scrollTop = log.scrollHeight;
    });
 
    socket.on("Forbidden_Word_Used" , (Forbidden_Word_Used) => {
      console.log("Forbidden word")
      alert("U Have Used A Forbidden Word")
    })
 
    socket.on("Correct_Answer", () => {
      alert("correct answer has been said")
      document.getElementById("drawBtn").disabled = false;
      if (My_Team == "Team_A") {
        scores.Team_A_Points ++
        console.log("Team A + 1")
        
        socket.emit("Points_Updated",(scores))
        
      } else if (My_Team == "Team_B") {
        scores.Team_B_Points ++
        console.log("Team B + 1")
        console.log(scores)
        
        socket.emit("Points_Updated",(scores))
      }
      
    })
    
    socket.on("Update_Points", (updated_Scores) => {
      scores = updated_Scores;
      console.log("Updated scores :",scores)
      document.getElementById("scoreTeamA").textContent = scores.Team_A_Points
      document.getElementById("scoreTeamB").textContent = scores.Team_B_Points
    })
    //socket.on("Score_Update", (scores) => {
    //document.getElementById("scoreTeamA").textContent = `Team A: ${scores.Team_A}`;
    //document.getElementById("scoreTeamB").textContent = `Team B: ${scores.Team_B}`;
    //});
 
    socket.on("Team_A_Turn", (currentRound) => {
      document.getElementById("PlayingTeamDisplay").textContent = "Team_A"
      if (My_Team === "Team_A" && My_Role === "card_holder") {
        document.getElementById("drawBtn").disabled = false
      }
      const round = currentRound
      document.getElementById("RoundDisplay").textContent = round
    })
 
    socket.on("Team_B_Turn", (currentRound) => {
      document.getElementById("PlayingTeamDisplay").textContent = "Team_B"
      if (My_Team === "Team_B" && My_Role === "card_holder") {
        document.getElementById("drawBtn").disabled = false
      }
      const round = currentRound
      document.getElementById("RoundDisplay").textContent = round
    })
 
    socket.on("Next_Round" , (data) =>{
      document.getElementById("RoundDisplay").textContent = data.round;
      document.getElementById("PlayingTeamDisplay").textContent = data.Team
    });
 
    //socket.on("Game_Over", () => {
      //alert("Game Over")
      //document.getElementById("drawBtn").disabled = true;
    //})
 
    document.getElementById("micBtn").addEventListener("click", () => {
      socket.emit("Mic_Pressed")
      console.log("Mic pressed")
    })
 
    socket.on("Transcribed_Text", (Text) => {
      const log = document.getElementById("chatLog");
      const newMsg = document.createElement("div");
      newMsg.textContent = `Other(Transcribed): ${Reply}`
      log.appendChild(newMsg);
      log.scrollTop = log.scrollHeight;
    });
 
 
 
  </script>
</body>
</html>